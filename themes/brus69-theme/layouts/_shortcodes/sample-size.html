<div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6">
    <!-- Заголовок -->
    <div class="text-center mb-6">
      <h2 class="text-xl font-bold text-gray-800">Калькулятор размера выборки</h2>
      <p class="text-sm text-gray-500 mt-1">Рассчитайте, сколько респондентов нужно опросить для статистически достоверных результатов (учитываются уровень доверия, погрешность, предполагаемая доля и при необходимости размер аудитории).</p>
    </div>

    <div class="flex flex-col md:flex-row gap-6">
      <!-- Левая колонка: Форма -->
      <div class="md:w-1/2 space-y-4">
        <!-- Уровень доверия -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Уровень доверия</label>
          <select 
            id="confidenceLevel" 
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
          >
            <option value="95">95% (Z = 1.96)</option>
            <option value="90">90% (Z = 1.645)</option>
            <option value="99">99% (Z = 2.576)</option>
          </select>
        </div>

        <!-- Допустимая погрешность -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Допустимая погрешность, % (E)</label>
          <input 
            type="number" 
            id="marginOfError" 
            value="5"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
          />
        </div>

        <!-- Предполагаемая доля -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Предполагаемая доля, % (p)</label>
          <input 
            type="number" 
            id="expectedProportion" 
            value="50"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
          />
        </div>

        <!-- Размер аудитории (необязательно) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Размер аудитории (N), необязательно</label>
          <input 
            type="number" 
            id="populationSize" 
            value="10"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent"
          />
        </div>

        <!-- Кнопка Рассчитать -->
        <button 
          id="calculateBtn"
          class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-full transition-colors duration-200 mt-4"
        >
          Рассчитать размер выборки
        </button>
      </div>

      <!-- Правая колонка: Результаты -->
      <div class="md:w-1/2 bg-gray-100 rounded-lg p-4">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Результаты</h2>
        <div class="space-y-2">
          <div><strong>Базовый размер выборки (без учёта N):</strong> <span id="baseSampleSize">—</span></div>
          <div><strong>С учётом конечной совокупности (N):</strong> <span id="correctedSampleSize">—</span></div>
          <div class="text-xs text-gray-600 mt-3">
            Учтена конечная совокупность: размер выборки скорректирован по формуле nₐ = (n × N) / (n + N − 1). Рекомендуется округлять вверх.
          </div>
        </div>
      </div>
    </div>

    <!-- Примечание внизу -->
    <div class="mt-6 text-xs text-gray-500">
      <strong>Заметка:</strong> если не знаете долю (p), используйте 50% — это даёт максимально консервативную оценку. Рекомендуется округлять размер выборки в большую сторону.
    </div>
  </div>

  <script>
    document.getElementById('calculateBtn').addEventListener('click', function() {
      const z = parseFloat(document.getElementById('confidenceLevel').value) === 95 ? 1.96 :
                parseFloat(document.getElementById('confidenceLevel').value) === 90 ? 1.645 : 2.576;
      
      const e = parseFloat(document.getElementById('marginOfError').value) / 100 || 0.05; // в долях
      const p = parseFloat(document.getElementById('expectedProportion').value) / 100 || 0.5; // в долях
      const nTotal = parseFloat(document.getElementById('populationSize').value) || 0;

      // Базовая формула: n = (Z² * p * (1-p)) / E²
      const baseN = Math.ceil((Math.pow(z, 2) * p * (1 - p)) / Math.pow(e, 2));

      // Коррекция для конечной совокупности: nₐ = (n × N) / (n + N − 1)
      let correctedN = baseN;
      if (nTotal > 0 && baseN > nTotal) {
        correctedN = Math.ceil((baseN * nTotal) / (baseN + nTotal - 1));
      } else if (nTotal > 0) {
        correctedN = Math.ceil((baseN * nTotal) / (baseN + nTotal - 1));
      }

      // Вывод результатов
      document.getElementById('baseSampleSize').textContent = baseN;
      document.getElementById('correctedSampleSize').textContent = correctedN;
    });
  </script>
